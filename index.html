<!DOCTYPE html>
<html>
  
  <head>
    <link rel="stylesheet" href="bootstrap-3.2.0-dist/css/bootstrap.css">
    <link rel="stylesheet" href="bootstrap-3.2.0-dist/css/bootstrap-theme.css">
    <link rel="stylesheet" href="custom.css">
    <script src="moment.js"></script>
    <script src="jquery.js"></script>
    <script src="bootstrap-3.2.0-dist/js/bootstrap.js"></script>
    <script src="data_generator.js"></script>
    <title>Twittler</title>
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="#">Twittler</a>
      </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#"><span class="glyphicon glyphicon-home"></span> Home</a></li>
              <li><a href="#about"><span class="glyphicon glyphicon-th-list"></span> People</a></li>
              <li><a href="#contact"><span class="glyphicon glyphicon-user"></span> Profile</a></li>
              <li><a href="#compose" class="btn btn-default"><span class="glyphicon glyphicon-pencil"></span> Compose</a>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
    </nav>

    <div class="container">
      <ol class="breadcrumb">
        <li><a href="#">Home</a></li>
        <li><a href="#">Library</a></li>
        <li class="active">Data</li>
      </ol>
    </div>

    <div class="container content-div">
    </div>

    <script>

      $(document).ready(function(){
        var $body = $('.content-div');
        $body.html('');

        //globals
        var applicationState = {
          alertDisplayed: false
        };

        var index = streams.home.length - 1;
        var lastFetchIndex = index;
        while(index >= 0){
          var tweet = streams.home[index];
          var prettyTime = moment(tweet.created_at).fromNow();
          /*
          var $tweet = $('<div></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message);
          */
          var $tweet = $('<div class="panel panel-default"><div class="panel-body">' + tweet.message +'</div><div class="panel-footer">' + '<strong>@' + tweet.user + '</strong> ' + '<small><em>' + prettyTime + '</em></small>' + '</div></div>');
          $tweet.appendTo($body);
          index -= 1;
        }


        var getNewTweets = function (user){ //specify user for specific user's new tweets
          var newIndex;
          //iterate through streams.
          if (1){ //home stream, no user specified
            newIndex = streams.home.length - 1;
            while(newIndex > lastFetchIndex){
              var tweet = streams.home[newIndex];
              var prettyTime = moment(tweet.created_at).fromNow();
      
              var $tweet = $('<div class="panel panel-default"><div class="panel-body">' + tweet.message +'</div><div class="panel-footer">' + '<strong>@' + tweet.user + '</strong> ' + '<small><em>' + prettyTime + '</em></small>' + '</div></div>');
              $tweet.prependTo($body);
              newIndex -= 1;


              }
              lastFetchIndex = streams.home.length -1;
            }

        };

        var mainTimer = function(){
         setTimeout(function (){
              console.log("Timer called");
              var numNewTweets = streams.home.length - 1 - lastFetchIndex;
              if(numNewTweets > 0){
                document.title = "(" + (streams.home.length - 1 - lastFetchIndex) + ")" + " Twittler";
                var $newTweetsMessage = $('<div class="alert alert-info"><a href="#">Click here to display ' + numNewTweets + ' new Tweets</a></div>');
                if (!applicationState.alertDisplayed){
                  $newTweetsMessage.prependTo($body);
                  applicationState.alertDisplayed = true;
                }else{
                  $(".alert").html($newTweetsMessage);
                }
                //getNewTweets();
              }
              mainTimer();

            }, 5000);
        }

        mainTimer();

      });

    </script>
  </body>
</html>
